<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymer-ajax/polymer-ajax.html">

<!--
Element that provide basic last.fm info based on a given user.

##### Example

    <lastfm-card></lastfm-card>

@element lastfm-card
@blurb Element that provide basic last.fm info based on a given user.
@status alpha
@homepage http://Granze.github.io/lastfm-card
-->
<polymer-element name="lastfm-card" attributes="user paintItBlack recentTracks topArtists">

  <template>
    <link rel="stylesheet" href="../normalize-css/normalize.css">
    <link rel="stylesheet" href="lastfm-card.css">

    <polymer-ajax url="http://ws.audioscrobbler.com/2.0/?method={{getInfo.info}}&user={{user}}&api_key={{apiKey}}&format=json" auto handleAs="json" response="{{info}}"></polymer-ajax>
    <polymer-ajax url="http://ws.audioscrobbler.com/2.0/?method={{getInfo.recentTracks}}&user={{user}}&api_key={{apiKey}}&format=json&limit={{getInfo.recentTracksLimit}}" auto handleAs="json" response="{{recentTracksData}}"></polymer-ajax>
    <polymer-ajax url="http://ws.audioscrobbler.com/2.0/?method={{getInfo.topArtists}}&user={{user}}&api_key={{apiKey}}&format=json&limit={{getInfo.topArtistsLimit}}" auto handleAs="json" response="{{artists}}"></polymer-ajax>

    <content>
      <div class="card">
        <header class="{{theme}}">
          <a href="http://www.last.fm" class="logo"></a>
        </header>
        <section class="profile">
          <figure class="frame">
            <img src="{{info.user.image[2]['#text']}}" alt="">
          </figure>
          <div class="personal-info">
            <h1><a href="{{info.user.url}}">{{info.user.name}}</a></h1>
          </div>
          <p>{{info.user.playcount}} plays since {{info.user.registered['#text']}}</p>
        </section>
        <template  if="{{recentTracks}}">
          <section class="recent-tracks alt">
            <h3>RECENT TRACKS:</h3>
            <ul>
              <template repeat="{{track in recentTracksData.recenttracks.track}}">
                <li>
                  <img src="{{track.image[1]['#text']}}" alt="{{track.album['#text']}}">
                  <strong>{{track.artist['#text']}}</strong>
                  <p>{{track.name}}</p>
                </li>
              </template>
            </ul>
          </section>
        </template>
        <template if="{{topArtists}}">
          <section class="top-artists alt">
            <h3>TOP ARTISTS (overall):</h3>
            <ol>
              <template repeat="{{artist in artists.topartists.artist}}">
                <li>{{artist.name}}</li>
              </template>
            </ol>
          </section>
        </template>
      </div>
    </content>

  </template>

  <script>

    Polymer('lastfm-card', {
      /**
       * The `apiKey` attribute is needed to fetch datas from the API service.
       *
       * @attribute apiKey
       * @type string
       */
      apiKey: 'd8cacd3e0cc258e27cf95e491f65760d',
      /**
       * The `getInfo` defines what kind of data you'll fetch.
       *
       * @attribute getInfo
       * @type object
       */
      created: function() {
        this.getInfo = {
          info: 'user.getinfo',
          recentTracks: 'user.getRecentTracks',
          topArtists: 'user.getTopArtists',
          recentTracksLimit: 3,
          topArtistsLimit: 5
        }
      },
      /**
       * The `user` attribute is the only needed parameter.
       *
       * @attribute user
       * @type string
       */
      user: 'granzebru',
      /**
       * The `paintItBlack` attribute specify the widget color. You have two options: `red` (default) or `black`.
       *
       * @attribute paintItBlack
       * @type string
       */
      paintItBlack: false,
      /**
       * The `recentTracks` attribute specify if you want to show the recentTracks played tracks.
       *
       * @attribute recentTracks
       * @type boolean
       */
      recentTracks: false,
      /**
       * The `topArtists` attribute specify if you want to show the topArtists played tracks.
       *
       * @attribute topArtists
       * @type boolean
       */
      topArtists: false,

      userChanged: function () {
        console.log('user changed');
      },
      recentTracksChanged: function () {
        console.log('recent tracks changed');
      },
      topArtistsChanged: function () {
        console.log('top artitsts changed');
      },
      paintItBlackChanged: function () {
        console.log('paintItBlack changed');
      },
      ready: function() {
        if(this.paintItBlack === true) {
          this.theme = 'black'
        }
      }
    });

  </script>

</polymer-element>
