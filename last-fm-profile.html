<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-image/iron-image.html">

<dom-module id="last-fm-profile">
  <style>
    :host {
      display: block;
      width: 350px;
      color: #333;
      border-radius: 0 0 4px 4px;
      font-family: Arial, Helvetica, sans-serif;
      text-align: left;
      background-color: #fff;
    }
    *,
    *:before,
    *:after {
      box-sizing: border-box;
    }
    a {
      color: #333;
    }
    a:hover {
      text-decoration: underline;
    }
    .card {
      border: 1px solid #ccc;
    }
    .card section {
      margin: 0 20px;
    }
    .card section.profile {
      margin-bottom: 20px;
    }
    .card section > h3 {
      margin: -10px -20px 0 -20px;
      padding: 4px 20px 2px 20px;
      font-size: 14px;
      text-shadow: #333 -1px -1px 1px;
      border-bottom: 2px solid #222;
      font-weight: normal;
      color: #dfdfdf;
      background-color: #555555;
    }
    .card header {
      position: relative;
      height: 45px;
      padding: 10px;
      margin: 0 0 20px 0;
      background-color: #e31b23;
      background-image: -webkit-linear-gradient(#e31b23, #b32024);
      background-image: linear-gradient(#e31b23, #b32024);
      border: 1px solid #a00;
      border-bottom: 1px solid #9f081e;
      box-shadow: rgba(0,0,0,0.3) 0 2px 5px;
    }
    .logo {
      position: absolute;
      left: 20px;
      bottom: 6px;
      display: inline-block;
      width: 90px;
      height: 30px;
      background-image: url(data:image/png;base64,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);
    }
    .profile {
      position: relative;
      height: 126px;
      padding-left: 146px;
    }
    .profile p {
      margin: 6px 0;
    }
    #plays {
      font-size: 0;
    }
    .count-bg {
      display: inline-block;
      margin-right: 2px;
      padding: 2px 3px 0 3px;
      font-size: 16px;
      color: #fff;
      background: #000000;
      background: -webkit-linear-gradient(top, #000000 0%, #3f3f3f 40%, #6b6b6b 50%, #3f3f3f 60%, #000000 100%);
      background: linear-gradient(to bottom,  #000000 0%,#3f3f3f 40%,#6b6b6b 50%,#3f3f3f 60%,#000000 100%);
    }
    .profile-image {
      position: absolute;
      left: 0;
      top: 0;
      display: block;
      overflow: hidden;
      width: 126px;
      min-height: 70px;
      max-height: 126px;
      margin: 0;
      border: 2px solid #999;
      border-radius: 4px;
      background-color: #333;
    }
    h1 {
      margin: 0 0 20px 0;
      padding: 0;
      font-size: 18px;
    }
    h1 a {
      text-decoration: none;
    }
    .info-error {
      padding: 10px 0;
      text-align: center;
    }
  </style>

  <template>
    <iron-ajax auto id="userajax"
               url="http://ws.audioscrobbler.com/2.0/"
               params="[[_ajaxParams(user, apiKey)]]"
               handleas="json" last-response="{{info}}">
    </iron-ajax>

    <div class="card">
      <header>
        <a href="http://www.last.fm" class="logo"></a>
      </header>
      <template is="dom-if" if="[[!info.error]]">
        <section class="profile">
          <iron-image class="profile-image" preload fade src="[[info.user.image.2.#text]]"></iron-image>
          <h1><a href="[[info.user.url]]">[[info.user.name]]</a></h1>
          <p>
            <strong id="plays">
              <template is="dom-repeat" items="[[_numberToArray(info.user.playcount)]]">
                <span class="count-bg">{{item}}</span>
              </template>
            </strong>
            <strong>&nbsp;plays</strong>
          </p>
          <p>since <span>[[_dateConverter(info.user.registered.unixtime)]]</span></p>
        </section>
      </template>
      <template is="dom-if" if="[[info.error]]">
        <p class="info-error">[[info.message]]</p>
      </template>
    </div>
  </template>
  <script>
    Polymer({
      is: 'last-fm-profile',
      /**
       * The `ajaxParams` method pass some parameters to the iron-ajax component
       *
       * @method ajaxParams
       * @private
       */
      _ajaxParams: function(user, apiKey) {
        return  {
          method: 'user.getinfo',
          user: user,
          api_key: apiKey,
          format: 'json'
        };
      },
      /**
       * The `numberToArray` method is a filter used to stylize the player count.
       *
       * @method numberToArray
       * @private
       */
      _numberToArray: function(number) {
        return (number || '').split('');
      },
      /**
       * The `dateConverter` method is a filter used to format the date.
       *
       * @method dateConverter
       * @private
       */
      _dateConverter: function(value) {
        if(typeof value !== 'undefined') {
          var d = new Date(value*1000);
          return d.toDateString().substr(4);
        }
      }
    });
  </script>
</dom-module>

