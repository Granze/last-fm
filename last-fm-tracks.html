<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-image/iron-image.html">

<dom-module id="last-fm-tracks">
  <template>
    <iron-ajax auto id="userajax"
               url="http://ws.audioscrobbler.com/2.0/"
               params="[[_ajaxParams(user, apiKey)]]"
               handleas="json" last-response="{{tracks}}">
    </iron-ajax>

    <div class="module">
      <template is="dom-if" if="[[!tracks.error]]">
        <section class="tracks">
          <h2>Recent tracks:</h2>
          <template is="dom-repeat" items="{{tracks.recenttracks.track}}">
            <iron-image class="" preload fade src="[[item.image.1.#text]]"></iron-image>
            <p>[[item.artist.#text]]</p>
            <p>[[item.name]]</p>
            <p>[[item.album.#text]]</p>
          </template>

        </section>
      </template>
      <template is="dom-if" if="[[tracks.error]]"></template>
    </div>
  </template>
  <script>
    Polymer({
      is: 'last-fm-tracks',
      /**
       * The `ajaxParams` method pass some parameters to the iron-ajax component
       *
       * @method ajaxParams
       * @private
       */
      _ajaxParams: function(user, apiKey) {
        return  {
          method: 'user.getrecenttracks',
          user: user,
          api_key: apiKey,
          format: 'json',
          limit: 3
        };
      }
    });
  </script>
</dom-module>

