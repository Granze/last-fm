<link rel="import" href="../polymer/polymer.html">

<dom-module id="last-fm">
  <style>
    :host {
      display: block;
      width: 350px;
    }
  </style>
  <template></template>
  <script>
    Polymer({
      is: 'last-fm',
      properties: {
        /**
         * The API key used to authenticate with Last.fm's API
         * This should ideally be changed to your own key.
         *
         * @attribute apiKey
         * @type String
         * @default ''
         */
        apiKey: {
          type: String,
          value: ''
        },
        /**
         * The `user` attribute is the only mandatory parameter.
         *
         * @attribute user
         * @type String
         * @default ''
         */
        user: {
          type: String,
          value: '',
          observer: '_userChanged'
        },
        /**
         * The `modules` attribute specify the modules to be loaded.
         *
         * @attribute modules
         * @type String
         * @default 'profile'
         */
        modules: {
          type: String,
          value: 'profile'
        }
      },
      /**
       * The `_importModule` method loads all the modules specified in the "modules" attribute.
       *
       * @method _importModule
       * @private
       */
      _importModule: function(modules) {
        modules.map(function(module) {
          var moduleName = 'last-fm-' + module;
          this.importHref(this.resolveUrl(moduleName + '.html'), function() {
            console.info(module + ' module imported!');
            var content = Polymer.dom(this.root),
                element = this.create(moduleName, {user: this.user, apiKey: this.apiKey});

            content.appendChild(element);
          }, function() {
            console.error('error importing module ' + moduleName);
          });
        }.bind(this));
      },
      _userChanged: function(newValue) {
        var children = Polymer.dom(this).node.childNodes;
        if(children) {
          for(var i = 0; i < children.length; i++){
            children[i].user = newValue;
          }
        }
      },
      attached: function() {
        this._importModule(this.modules.split(' '));
      }
    });
  </script>
</dom-module>

